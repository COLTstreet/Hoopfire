<div class="container mx-auto p-4">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>

  <!-- Action Buttons Header -->
  <div class="flex justify-between items-center mb-4">
    <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200">Custom NBA Games</h2>
    <div class="flex gap-2">
      <p-button icon="pi pi-file-excel" [rounded]="true" [text]="true" pTooltip="Export All Games"
        (onClick)="exportToExcel()" aria-label="Export all games to Excel">
      </p-button>
      <p-button icon="pi pi-times-circle" [rounded]="true" [text]="true" pTooltip="Clear All Games"
        (onClick)="clearAllGames()" aria-label="Clear all games">
      </p-button>
    </div>
  </div>

  <!-- Team Selection Cards -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
    <!-- Left Team Selection -->
    <div class="bg-surface-0 dark:bg-surface-900 p-6 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700">
      <div class="flex flex-col lg:flex-row items-center lg:items-start gap-4">
        <div class="flex-shrink-0">
          <div class="text-center mb-2">
            <span class="text-xs text-gray-500 uppercase">Predicted Score</span>
          </div>
          <span class="text-6xl font-bold text-gray-800 dark:text-gray-200 block text-center">
            {{leftScore || '--'}}
          </span>
        </div>
        <div class="flex-1 w-full">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Select Left Team
          </label>
          <p-select [options]="allFirestoreTeams" [(ngModel)]="selectedLeftTeam" optionLabel="team"
            placeholder="Select a Team" class="w-full" [filter]="true" filterBy="team" [showClear]="true"
            (onChange)="calculateOdds()" aria-label="Select left team">
          </p-select>
          @if (selectedLeftTeam) {
          <div class="flex justify-center mt-4 h-32 items-center">
            <img [src]="selectedLeftTeam.WikipediaLogoUrl" [alt]="selectedLeftTeam.team + ' logo'"
              class="w-32 h-32 object-contain">
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Right Team Selection -->
    <div class="bg-surface-0 dark:bg-surface-900 p-6 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700">
      <div class="flex flex-col lg:flex-row items-center lg:items-start gap-4">
        <div class="flex-shrink-0">
          <div class="text-center mb-2">
            <span class="text-xs text-gray-500 uppercase">Predicted Score</span>
          </div>
          <span class="text-6xl font-bold text-gray-800 dark:text-gray-200 block text-center">
            {{rightScore || '--'}}
          </span>
        </div>
        <div class="flex-1 w-full">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Select Right Team
          </label>
          <p-select [options]="allFirestoreTeams" [(ngModel)]="selectedRightTeam" optionLabel="team"
            placeholder="Select a Team" class="w-full" [filter]="true" filterBy="team" [showClear]="true"
            (onChange)="calculateOdds()" aria-label="Select right team">
          </p-select>
          @if (selectedRightTeam) {
          <div class="flex justify-center mt-4 h-32 items-center">
            <img [src]="selectedRightTeam.WikipediaLogoUrl" [alt]="selectedRightTeam.team + ' logo'"
              class="w-32 h-32 object-contain">
          </div>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Add Matchup Button -->
  <div class="flex justify-center mb-6">
    <p-button label="Add To Matchups" icon="pi pi-plus" (onClick)="addMatchup('User Generated')"
      [disabled]="!selectedLeftTeam || !selectedRightTeam" class="px-6" aria-label="Add current matchup to list">
    </p-button>
  </div>

  <!-- Matchups Grid -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
    @for (game of matchups; track game; let i = $index) {
    <div
      class="bg-surface-0 dark:bg-surface-900 shadow-lg rounded-lg border border-gray-200 dark:border-gray-700 p-6 relative hover:shadow-xl transition-shadow">
      <!-- Remove Button -->
      <p-button icon="pi pi-times" [rounded]="true" [text]="true" [severity]="'danger'" pTooltip="Remove Game"
        (onClick)="confirmRemoveSingleGame($event, i)" class="absolute top-2 right-2 z-10"
        aria-label="Remove this game">
      </p-button>

      <!-- Game Time Header -->
      <div class="text-center mb-4 pb-3 border-b border-gray-200 dark:border-gray-700">
        <div class="text-sm text-gray-500 dark:text-gray-400 font-medium">
          {{game.gameTime}}
        </div>
      </div>

      <!-- Teams Comparison -->
      <div class="flex justify-between items-center mb-4">
        <!-- Left Team -->
        <div class="flex flex-col items-center flex-1">
          <img [src]="game.leftWikipediaLogoUrl" [alt]="game.leftTeam + ' logo'" class="w-16 h-16 object-contain mb-2">
          <div class="text-center">
            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">
              {{game.leftTeam}}
            </div>
            <div class="text-3xl font-bold mb-2" [class.text-green-600]="game.leftScore > game.rightScore"
              [class.text-gray-800]="game.leftScore <= game.rightScore"
              [class.dark:text-green-400]="game.leftScore > game.rightScore"
              [class.dark:text-gray-200]="game.leftScore <= game.rightScore">
              {{game.leftScore}}
            </div>
            <p-chip
              [class]="game.leftScore > game.rightScore ? 'bg-green-100 text-green-800 border-green-200' : 'bg-gray-100 text-gray-600 border-gray-200'"
              class="text-xs">
              {{game.leftSpread}}
            </p-chip>
          </div>
        </div>

        <!-- VS Divider -->
        <div class="px-4 text-gray-400 font-bold">VS</div>

        <!-- Right Team -->
        <div class="flex flex-col items-center flex-1">
          <img [src]="game.rightWikipediaLogoUrl" [alt]="game.rightTeam + ' logo'"
            class="w-16 h-16 object-contain mb-2">
          <div class="text-center">
            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">
              {{game.rightTeam}}
            </div>
            <div class="text-3xl font-bold mb-2" [class.text-green-600]="game.rightScore > game.leftScore"
              [class.text-gray-800]="game.rightScore <= game.leftScore"
              [class.dark:text-green-400]="game.rightScore > game.leftScore"
              [class.dark:text-gray-200]="game.rightScore <= game.leftScore">
              {{game.rightScore}}
            </div>
            <p-chip
              [class]="game.rightScore > game.leftScore ? 'bg-green-100 text-green-800 border-green-200' : 'bg-gray-100 text-gray-600 border-gray-200'"
              class="text-xs">
              {{game.rightSpread}}
            </p-chip>
          </div>
        </div>
      </div>

      <!-- Game Stats Footer -->
      <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm text-gray-600 dark:text-gray-400">Total Points:</span>
          <span class="text-lg font-semibold text-gray-800 dark:text-gray-200">
            {{game.totalPoints}}
          </span>
        </div>
        <div class="flex justify-between items-center">
          <span class="text-sm text-gray-600 dark:text-gray-400">Confidence:</span>
          <p-chip [class]="getConfidenceClass(game.confidence)" class="text-sm font-semibold">
            {{game.confidence}}
          </p-chip>
        </div>
      </div>
    </div>
    }

    <!-- Empty State -->
    @if (matchups.length === 0) {
    <div class="col-span-full text-center py-12">
      <div class="text-gray-400 dark:text-gray-500 mb-2">
        <i class="pi pi-calendar-times text-6xl"></i>
      </div>
      <p class="text-lg text-gray-500 dark:text-gray-400 font-medium">
        No matchups added yet
      </p>
      <p class="text-sm text-gray-400 dark:text-gray-500 mt-2">
        Select teams above and click "Add To Matchups" to create a matchup
      </p>
    </div>
    }
  </div>
</div>